!function(e){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=9)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GENERATE_GUID=t.CAPITALIZE=t.SAVEGAMEPREFIX=t.UIFONTBTN=t.UIFONTSMALL=t.UIFONTLARGE=t.CANVASMARGIN=t.CANVASWIDTH=t.PIECESPRITEWIDTH=t.CELLWIDTH=t.NUMFILES=t.NUMRANKS=t.CASTLEABLESQCOLOR=t.POSSIBLESQCOLOR=t.DARKSQCOLOR=t.LIGHTSQCOLOR=t.FILE=t.SIDE=t.PIECETYPE=void 0;var s,o=i(2);!function(e){e[e.empty=0]="empty",e[e.pawn=1]="pawn",e[e.rook=2]="rook",e[e.knight=3]="knight",e[e.bishop=4]="bishop",e[e.queen=5]="queen",e[e.king=6]="king"}(t.PIECETYPE||(t.PIECETYPE={})),function(e){e[e.black=0]="black",e[e.white=1]="white"}(t.SIDE||(t.SIDE={})),function(e){e[e.a=0]="a",e[e.b=1]="b",e[e.c=2]="c",e[e.d=3]="d",e[e.e=4]="e",e[e.f=5]="f",e[e.g=6]="g",e[e.h=7]="h"}(s=t.FILE||(t.FILE={})),t.LIGHTSQCOLOR=o.colorSqLight,t.DARKSQCOLOR=o.colorSqDark,t.POSSIBLESQCOLOR=o.colorSqPossible,t.CASTLEABLESQCOLOR=o.colorSqCastleable,t.NUMRANKS=8,t.NUMFILES=Object.keys(s).length/2,t.CELLWIDTH=o.cellWidth,t.PIECESPRITEWIDTH=o.spriteWidth,t.CANVASWIDTH=o.canvasWidth,t.CANVASMARGIN=o.canvasMargin,t.UIFONTLARGE=o.uiFontLarge,t.UIFONTSMALL=o.uiFontSmall,t.UIFONTBTN=o.uiFontBtn,t.SAVEGAMEPREFIX=o.saveGamePrefix,t.CAPITALIZE=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.GENERATE_GUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/x/g,(function(){return(16*Math.random()|0).toString(16)})).replace(/y/,(function(){return(4*Math.random()+8|0).toString(16)}))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Piece=void 0;var s=i(0),o=i(3),n=function(){function e(e,t){this._coord="",this._forward=1,this.active=!1,this.captured=!1,this.possibleMoves=new Array,this.side=s.SIDE.white,this.type=s.PIECETYPE.pawn,this.value=100,this.side=e,this.type=t,this._forward=this.side==s.SIDE.white?1:-1,this._id=s.GENERATE_GUID()}return e.prototype._iterateMoves=function(e,t,i,o){for(var n=new Array;e.cellInBounds(t);){var a=s.FILE[t[0]]+i,r=parseInt(t[1])+o;if(t!=this.getCoord()){var c=e.getCellByCoord(t);if(c.isOccupied()){c.piece.side!=this.side&&(n.push(t),c.possibleMove=!0);break}n.push(t),c.possibleMove=!0}t=""+s.FILE[a]+r}return n},e.prototype.canMove=function(e){return console.error("Piece.canMove: canMove has not been implemented!"),[]},e.prototype.draw=function(e,t,i,o,n){var a=e.naturalWidth-this.type*s.PIECESPRITEWIDTH,r=this.side==s.SIDE.white?0:s.PIECESPRITEWIDTH,c=s.PIECESPRITEWIDTH,h=s.PIECESPRITEWIDTH;t.drawImage(e,a,r,c,h,i,o,n,n)},e.prototype.getCoord=function(){return this._coord},e.prototype.getDiagMoves=function(e,t,i){var s=this.getCoord(),o=i?1:-1,n=(t?1:-1)*this._forward;return this._iterateMoves(e,s,o,n)},e.prototype.getId=function(){return this._id},e.prototype.getPerpMoves=function(e,t,i){var s=this.getCoord(),o=t?0:i?1:-1,n=t?(i?1:-1)*this._forward:0;return this._iterateMoves(e,s,o,n)},e.prototype.getPieceType=function(){return s.CAPITALIZE(s.PIECETYPE[this.type])},e.prototype.getSide=function(){return s.CAPITALIZE(s.SIDE[this.side])},e.prototype.overrideCoord=function(e){this._coord=e},e.prototype.move=function(e){return!!(e instanceof o.Cell&&this.possibleMoves.includes(e.getCoord()))&&(this._coord=e.getCoord(),e.piece=this,this.possibleMoves=[],!0)},e}();t.Piece=n},function(e){e.exports=JSON.parse('{"canvasId":"chess_board","canvasWidth":680,"canvasMargin":20,"cellWidth":80,"piecesImgId":"pieces_img","spriteWidth":100,"colorSqLight":"#919191","colorSqDark":"#333","colorSqPossible":"#40ff00","colorSqCastleable":"#5900b3","uiId":"chess_ui","uiFontLarge":"bold 20px sans-serif","uiFontSmall":"16px sans-serif","uiFontBtn":"bold 15px sans-serif","saveGamePrefix":"TypeChessSave"}')},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cell=void 0;var s=i(0),o=function(){function e(e,t,i){return this.castleable=!1,this.file=0,this.isLight=!1,this.possibleMove=!1,this.piece=null,this.rank=0,t>s.NUMRANKS||t<1?(console.error("Cell.constructor: Invalid rank value."),null):(this.file=e,this.rank=t,this.isLight=!!i,this)}return e.prototype.getFile=function(){return s.FILE[this.file]},e.prototype.getCoord=function(){return""+this.getFile()+this.rank},e.prototype.isOccupied=function(){return null!=this.piece},e}();t.Cell=o},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.King=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.king)||this;return i.hasMoved=!1,i.origCoord=["e1","e8"],i.value=5e4,i.possibleMoves=i.origCoord,i}return o(t,e),t.prototype.canMove=function(e){var t,i,s=this._coord[0],o=parseInt(this._coord[1]),a=new Array;(this.active=!0,this.possibleMoves=[],this.hasMoved||e.getCellByCoord("f"+o).isOccupied()||e.getCellByCoord("g"+o).isOccupied()||!e.getCellByCoord("h"+o).isOccupied())||((t=e.getCellByCoord("h"+o).piece).type!=n.PIECETYPE.rook||t.hasMoved||((i=e.getCellByCoord("g"+o)).possibleMove=!0,i.castleable=!0,this.possibleMoves.push(i.getCoord())));this.hasMoved||e.getCellByCoord("d"+o).isOccupied()||e.getCellByCoord("c"+o).isOccupied()||e.getCellByCoord("b"+o).isOccupied()||!e.getCellByCoord("a"+o).isOccupied()||((t=e.getCellByCoord("a"+o).piece).type!=n.PIECETYPE.rook||t.hasMoved||((i=e.getCellByCoord("c"+o)).possibleMove=!0,i.castleable=!0,this.possibleMoves.push(i.getCoord())));a.push(""+n.FILE[n.FILE[s]+1]+o),a.push(""+n.FILE[n.FILE[s]-1]+o),a.push(""+s+(o+1)),a.push(""+s+(o-1)),a.push(""+n.FILE[n.FILE[s]+1]+(o+1)),a.push(""+n.FILE[n.FILE[s]-1]+(o-1)),a.push(""+n.FILE[n.FILE[s]-1]+(o+1)),a.push(""+n.FILE[n.FILE[s]+1]+(o-1));for(var r=0;r<a.length;r++){var c=a[r];if(e.cellInBounds(c)){var h=e.getCellByCoord(c);if(h.isOccupied()){h.piece.side!=this.side&&(this.possibleMoves.push(c),h.possibleMove=!0);continue}this.possibleMoves.push(c),h.possibleMove=!0}}return this.possibleMoves},t.prototype.castleMove=function(e,t){if(e.castleable&&!this.hasMoved){var i=e.file==n.FILE.c?"a":"h",s=e.rank,o=(e.file==n.FILE.c?"d":"f")+s,a=t.getCellByCoord(i+s),r=a.piece;return a.piece=null,r.possibleMoves.push(o),r.move(t.getCellByCoord(o)),this.move(e),r.getId()}this.move(e)},t.prototype.move=function(t){return!(!e.prototype.move.call(this,t)||!(t.file!=n.FILE.e||this.side==n.SIDE.black&&8!=t.rank||this.side==n.SIDE.white&&1!=t.rank))&&(this.hasMoved=!0,!0)},t}(i(1).Piece);t.King=a},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Pawn=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.pawn)||this;return i.hasMoved=!1,i.origCoord=["a2","b2","c2","d2","e2","f2","g2","h2","a7","b7","c7","d7","e7","f7","g7","h7"],i.value=100,i.possibleMoves=i.origCoord,i}return o(t,e),t.prototype.canMove=function(e){var t=this.getCoord()[0],i=parseInt(this.getCoord()[1]);this.active=!0,this.possibleMoves=[];var s=""+t+(i+this._forward),o=e.getCellByCoord(s);e.cellInBounds(s)&&!o.isOccupied()&&this.possibleMoves.push(s);var a=""+t+(i+this._forward+this._forward),r=e.getCellByCoord(a);this.hasMoved||!e.cellInBounds(a)||r.isOccupied()||o.isOccupied()||this.possibleMoves.push(a);var c=this.side==n.SIDE.white?n.SIDE.black:n.SIDE.white,h=""+n.FILE[n.FILE[t]-1]+(i+this._forward);e.cellInBounds(h)&&((l=e.getCellByCoord(h)).isOccupied()&&l.piece.side==c&&this.possibleMoves.push(h));var l,u=""+n.FILE[n.FILE[t]+1]+(i+this._forward);e.cellInBounds(u)&&((l=e.getCellByCoord(u)).isOccupied()&&l.piece.side==c&&this.possibleMoves.push(u));return this.possibleMoves.forEach((function(t){e.getCellByCoord(t).possibleMove=!0})),this.possibleMoves},t.prototype.move=function(t){return!(!e.prototype.move.call(this,t)||!(this.side==n.SIDE.black&&7!=t.rank||this.side==n.SIDE.white&&2!=t.rank))&&(this.hasMoved=!0,!0)},t}(i(1).Piece);t.Pawn=a},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Rook=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.rook)||this;return i.hasMoved=!1,i.origCoord=["a1","h1","a8","h8"],i.value=550,i.possibleMoves=i.origCoord,i}return o(t,e),t.prototype.canMove=function(e){return this.active=!0,this.possibleMoves=[],this.possibleMoves=this.possibleMoves.concat(this.getPerpMoves(e,!0,!0),this.getPerpMoves(e,!0,!1),this.getPerpMoves(e,!1,!0),this.getPerpMoves(e,!1,!1)),this.possibleMoves},t.prototype.move=function(t){return e.prototype.move.call(this,t)&&(t.file!=n.FILE.a&&t.file!=n.FILE.h||this.side==n.SIDE.black&&8!=t.rank||this.side==n.SIDE.white&&1!=t.rank)&&(this.hasMoved=!0),!1},t}(i(1).Piece);t.Rook=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;var s={text:"Ok",value:!0},o={text:"Cancel",value:!1},n=function(){function e(e,t,i,o){var n=this;if(this.button_options=new Array,this.dangerMode=!1,this.buttons={confirm:s},e&&(this.title=e),t)if("string"==typeof t)this.message=t;else{var a=(new XMLSerializer).serializeToString(t);this.message=a}i&&(this.buttons=i),o&&(this.dangerMode=o),Object.keys(this.buttons).forEach((function(e,t){var i=n.buttons[e];n._translateBtnOption(i,t)}))}return e.prototype._hide=function(){var e=document.getElementsByClassName("modal")[0],t=document.getElementsByClassName("modal-overlay")[0];return e.style.visibility="hidden",t.style.visibility="hidden",setTimeout((function(){document.body.removeChild(t),document.body.removeChild(e)}),150),!0},e.prototype._translateBtnOption=function(e,t){if("object"==typeof e)this.button_options.push(e);else if("boolean"==typeof e&&1==e)0==t&&Object.keys(this.buttons).length>1?this.button_options.push(o):0!=t&&1!=t||this.button_options.push(s);else if("string"==typeof e){var i=Object.keys(this.buttons).length;0==t&&i>1?this.button_options.push({text:e,value:!1}):0==t||t==i-1?this.button_options.push({text:e,value:!0}):this.button_options.push({text:e,value:e})}},e.prototype.show=function(){var e=this;return new Promise((function(t){var i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div");i.classList.add("modal-overlay"),s.classList.add("modal"),o.classList.add("title"),n.classList.add("msg"),a.classList.add("btns"),o.innerHTML=e.title,n.innerHTML=e.message,s.appendChild(o),s.appendChild(n),s.appendChild(a),document.body.appendChild(i),document.body.appendChild(s),e.button_options.forEach((function(i,s){var o=document.createElement("button");(0==s&&1==e.button_options.length||s==e.button_options.length-1)&&(o.classList.add("confirm"),e.dangerMode&&o.classList.add("danger")),o.value=i.value,o.innerHTML=i.text,i.className&&("string"==typeof i.className?o.classList.add(i.className):i.className.forEach((function(e){o.classList.add(e)}))),o.addEventListener("click",(function(s){e._hide(),t(i.value)})),a.appendChild(o)}))}))},e}();t.Modal=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Turn=void 0;var s=function(e,t){return this.capture=null,this.endCoord="",this.movedPiece=null,this.side=null,this.startCoord="",this.msgs=new Array,this.castleRookId=null,2==t.length?(this.movedPiece=e,this.side=this.movedPiece.side,this.startCoord=this.movedPiece.getCoord(),this.endCoord=t,this):null};t.Turn=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(10),i(11);var s=i(2),o=i(12);window.addEventListener("load",(function(e){var t=document.getElementById(s.canvasId),i=null,n=document.getElementById(s.piecesImgId),a=document.getElementById(s.uiId);(i=new o.Typechess(t,n,a)).draw(),t.addEventListener("click",(function(e){i.click(e)}))}))},function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Typechess=void 0;var s=i(0),o=i(13),n=i(14),a=i(15),r=i(16),c=i(7),h=i(17),l=i(18),u=i(8),d=function(){function e(e,t,i){var c=this;return this.board=new o.Board(e,t),this.ai=new n.ChessAi(this.board,(function(e,t){return c.executeMove(e,t)})),this.match=new r.Match(new l.Team(s.SIDE.white),new l.Team(s.SIDE.black),this.ai),this.ui=new a.ChessUi(i),this.match.updateStatusCallback=function(e){return c.updateStatus(e)},this.setupPieces(this.match.team1),this.setupPieces(this.match.team2),this.ui.callback_load=function(e){return c.loadGame(e)},this.ui.callback_reset=function(e){return c.reset()},this.ui.callback_save=function(e){return c.saveGame(e)},this.ui.callback_undo=function(e){return c.undoMove()},this.ui.callback_engage_ai=function(e,t){return void 0===t&&(t=!1),c.engageAi(e,t)},this}return e.prototype.clearPossible=function(){this.board.clearPossible(),this.match.clearPossible()},e.prototype.click=function(e){var t=this.board.getCellByPixels(e.offsetX,e.offsetY),i=this.match.team1.side==this.match.whosTurn()?this.match.team1:this.match.team2;if(!this.match.checkmate){if(this.match.ai_engaged&&i.side==this.ai.side)return;if(t&&t.isOccupied()&&t.piece.side==i.side){var s=t.piece;this.clearPossible(),i.activePiece=s,s.canMove(this.board),this.draw()}else null!=i.activePiece&&t.possibleMove?this.executeMove(i,t):(this.clearPossible(),this.draw())}},e.prototype.draw=function(){this.board.draw(),this.ui.draw(this.match.getWhiteTeam().getScore(),this.match.getBlackTeam().getScore(),this.match.turns)},e.prototype.engageAi=function(e,t){void 0===t&&(t=!1);var i=s.SIDE[e];if(t)this.ai.side=null,this.match.ai_engaged=!1;else{var o=i==s.SIDE[s.SIDE.black]?this.match.getBlackTeam():this.match.getWhiteTeam();this.ai.side=o.side,this.match.ai_engaged=!0,this.ai.side==this.match.whosTurn()&&this.ai.takeTurn(o)}},e.prototype.executeMove=function(e,t){if(this.match.startTurn(e.activePiece,t),this.board.getCellByCoord(e.activePiece.getCoord()).piece=null,e.activePiece.type==s.PIECETYPE.king){var i=e.activePiece;this.match.turns[this.match.turns.length-1].castleRookId=i.castleMove(t,this.board)}else e.activePiece.move(t);return this.match.finishTurn()?(this.clearPossible(),this.draw(),!0):(this.undoMove(),this.updateStatus(e.getSide()+" tried to sacrifice their king!"),!1)},e.prototype.loadGame=function(e){var t=this,i=function(e,i,s){var o=s.pieces[i],n=t.board.getCellByCoord(e.getCoord());e.captured=o.captured,n.piece=null,e.captured||(e.possibleMoves=[o._coord],e.move(t.board.getCellByCoord(o._coord)))};e?(this.reset(),this.match.team1.pieces.forEach((function(t,s){i(t,s,e.team1)})),this.match.team2.pieces.forEach((function(t,s){i(t,s,e.team2)})),e.team1.captures&&e.team1.captures instanceof Array&&e.team1.captures.forEach((function(e){t.match.team1.captures.push(e)})),e.team2.captures&&e.team2.captures instanceof Array&&e.team2.captures.forEach((function(e){t.match.team2.captures.push(e)})),e.turns&&e.turns instanceof Array&&e.turns.forEach((function(e){var i,o=e.side==s.SIDE.white?t.match.getWhiteTeam():t.match.getBlackTeam(),n=o.getPieceById(e.movedPiece._id)||o.pieces[e.movedPiece._id],a=n.getCoord();n.overrideCoord(e.startCoord),i=new u.Turn(n,e.endCoord),n.overrideCoord(a),i.msgs=e.msgs,i.capture=e.capture,i.castleRookId=e.castleRookId,t.match.turns.push(i)})),this.draw(),new c.Modal("Load Game",'"'+e.name+'" loaded successfully!').show()):new c.Modal("Load Game","ERROR: Game not found!",[!1,!0],!0).show()},e.prototype.reset=function(){this.constructor(this.board.canvas,this.board.pieces_img,this.ui.getUiDiv()),this.draw()},e.prototype.saveGame=function(e){var t=new c.Modal;if(t.title="Save Game",e.length>0){var i=new h.SaveGame(e,this.match.team1,this.match.team2,this.match.turns);window.localStorage.setItem(s.SAVEGAMEPREFIX+"_"+e,JSON.stringify(i)),t.message='Game successfully saved as "'+e+'"!',t.show()}else(t=new c.Modal(t.title,"ERROR! You must enter a save name!  Please try again.",[!1,!0],!0)).show()},e.prototype.setupPieces=function(e){var t=this,i=Object.keys(s.FILE),o=e.side==s.SIDE.white?"2":"7",n=e.side==s.SIDE.white?"1":"8";e.pieces.forEach((function(e,a){var r="";a<i.length&&e.type==s.PIECETYPE.pawn?r=i[a+i.length/2]+o:8==a?r="a"+n:9==a?r="h"+n:10==a?r="b"+n:11==a?r="g"+n:12==a?r="c"+n:13==a?r="f"+n:14==a?r="d"+n:15==a&&(r="e"+n),e.move(t.board.getCellByCoord(r))}))},e.prototype.undoMove=function(){if(0!=this.match.turns.length){var e=this.match.turns[this.match.turns.length-1],t=e.movedPiece,i=e.capture,o=e.side==s.SIDE.white?this.match.getWhiteTeam():this.match.getBlackTeam();if(this.board.getCellByCoord(t.getCoord()).piece=null,t.possibleMoves=[e.startCoord],t.move(this.board.getCellByCoord(e.startCoord)),t.type==s.PIECETYPE.rook||t.type==s.PIECETYPE.pawn||t.type==s.PIECETYPE.king){var n=t;null!=n.hasMoved&&null!=n.origCoord&&n.origCoord.includes(e.startCoord)&&(n.hasMoved=!1)}if(null!=i){for(var a=o,r=o.side==s.SIDE.white?this.match.getBlackTeam():this.match.getWhiteTeam(),c=0;c<r.pieces.length;c++){var h=r.pieces[c];if(h.captured&&h.getId()==i._id){h.captured=!1,h.possibleMoves=[e.endCoord],h.move(this.board.getCellByCoord(e.endCoord));break}}this.match.checkmate&&a.captures.pop(),a.captures.pop()}if(null!=e.castleRookId){var l=o.getPieceById(e.castleRookId),u=s.FILE[e.endCoord[1]]==s.FILE.c?"a":"h",d=l.getCoord(),p=u+d[1];l.possibleMoves.push(p),l.move(this.board.getCellByCoord(p)),l.hasMoved=!1,this.board.getCellByCoord(d).piece=null}this.match.turns.pop(),this.match.checkmate&&(this.match.checkmate=!1),this.draw()}},e.prototype.updateStatus=function(e){var t=this.match.turns[this.match.turns.length-1];null!=t&&t.msgs.push(e)},e}();t.Typechess=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Board=void 0;var s=i(0),o=i(3),n=function(){function e(e,t){this._canvas_offset_x=0,this._canvas_offset_y=0,this.cells=new Array,this.canvas=e,this.canvas.width=s.CANVASWIDTH,this.canvas.height=s.CANVASWIDTH,this.ctx=e.getContext("2d"),this.pieces_img=t;var i=s.NUMFILES*s.CELLWIDTH;s.NUMRANKS,s.CELLWIDTH;this._canvas_offset_x=(e.width-i)/2,this._canvas_offset_y=s.CANVASMARGIN;for(var n=0;n<s.NUMRANKS;n++)for(var a=0;a<s.NUMFILES;a++){var r=!!((n+a)%2);this.cells.push(new o.Cell(a,n+1,r))}}return e.prototype._validateCoord=function(e){if(2!=e.length)return!1;if(isNaN(parseInt(e[0]))&&Object.keys(s.FILE).includes(e[0])){var t=parseInt(e[1]);return!(isNaN(t)||t>s.NUMRANKS||t<1)}return!1},e.prototype.cellInBounds=function(e){return this._validateCoord(e)},e.prototype.clearPossible=function(){this.cells.forEach((function(e){e.possibleMove=!1,e.castleable=!1}))},e.prototype.draw=function(){var e=this,t=s.LIGHTSQCOLOR,i=s.DARKSQCOLOR,o=s.CELLWIDTH;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.fillStyle="#121212",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.cells.forEach((function(n){var a=n.file*o+e._canvas_offset_x,r=s.NUMRANKS*o-o*(n.rank-1)-o+e._canvas_offset_y;if(e.ctx.beginPath(),e.ctx.fillStyle=n.isLight?t:i,n.isOccupied()&&n.piece.active&&(e.ctx.fillStyle=s.POSSIBLESQCOLOR),e.ctx.fillRect(a,r,o,o),e.ctx.closePath(),e.ctx.beginPath(),e.ctx.fillStyle=n.isLight?i:t,e.ctx.font=s.UIFONTBTN,1==n.rank&&e.ctx.fillText(s.FILE[n.file],a+o-10,r+o-5),n.file==s.FILE.a&&e.ctx.fillText(n.rank+"",a+3,r+15),e.ctx.closePath(),n.possibleMove){var c=a+3,h=r+3,l=o-6;e.ctx.beginPath(),e.ctx.lineWidth=6,e.ctx.strokeStyle=s.POSSIBLESQCOLOR,n.castleable&&(e.ctx.strokeStyle=s.CASTLEABLESQCOLOR),e.ctx.rect(c,h,l,l),e.ctx.stroke(),e.ctx.closePath()}n.isOccupied()&&n.piece.draw(e.pieces_img,e.ctx,a,r,o)}))},e.prototype.getCellByCoord=function(e){if(this._validateCoord(e)){var t=e[0],i=parseInt(e[1])*s.NUMFILES-s.NUMRANKS+s.FILE[t];return this.cells[i]}},e.prototype.getCellByPixels=function(e,t){var i=s.FILE[Math.floor((e-this._canvas_offset_x)/s.CELLWIDTH)],o=s.NUMRANKS-Math.floor((t-this._canvas_offset_y)/s.CELLWIDTH);return this.getCellByCoord(""+i+o)},e}();t.Board=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChessAi=void 0;var s=i(4),o=i(5),n=i(6),a=function(){function e(e,t){this._board=e,t&&(this._executeMoveCallback=t)}return e.prototype._executeMove=function(e,t){return"function"==typeof this._executeMoveCallback&&this._executeMoveCallback(e,t)},e.prototype.detectCheck=function(e,t){for(var i=0;i<t.pieces.length;i++){var s=t.pieces[i];if(!s.captured&&(s.canMove(this._board),s.possibleMoves.includes(e)))return!0}return!1},e.prototype.detectCheckMate=function(e,t){var i=this,a=!0;return e.pieces.forEach((function(r){new Array;var c=i._board.getCellByCoord(r.getCoord());r.captured||r.canMove(i._board).forEach((function(h){var l,u=i._board.getCellByCoord(h),d=u.piece,p=!1;if((r instanceof o.Pawn||r instanceof n.Rook||r instanceof s.King)&&(p=r.hasMoved),r.possibleMoves=[h],r.move(u),l=e.pieces[15].getCoord(),i.detectCheck(l,t)||(a=!1),u.piece=null,r.possibleMoves=[c.getCoord()],r.move(c),(r instanceof o.Pawn||r instanceof n.Rook||r instanceof s.King)&&(r.hasMoved=p),null!=d&&(u.piece=d),0==a)return a}))})),a},e.prototype.takeTurn=function(e){var t=this;if(null!==this.side){var i,s=[],o=[],n=void 0,a=void 0;if(e.pieces.forEach((function(e,i){var n=e.canMove(t._board);n.length>0&&!e.captured&&(s.push(e),n.forEach((function(i){var s=t._board.getCellByCoord(i);s.isOccupied()&&o.push({piece:e,coord:i,value:s.piece.value})})))})),o.length>0){var r;o.sort((function(e,t){return e.value>t.value?-1:e.value<t.value?1:0})),r=o[0],e.activePiece=r.piece,a=this._board.getCellByCoord(r.coord)}else n=Math.floor(Math.random()*s.length),e.activePiece=s[n],n=Math.floor(Math.random()*e.activePiece.possibleMoves.length),i=e.activePiece.possibleMoves[n],a=this._board.getCellByCoord(i);return!!this._executeMoveCallback(e,a)||this.takeTurn(e)}},e}();t.ChessAi=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChessUi=void 0;var s=i(0),o=i(7),n=function(){function e(e){this._ai_side=null,this._initialized=!1,this.callback_save=null,this.callback_load=null,this.callback_reset=null,this.callback_undo=null,this.callback_engage_ai=null,this._ui_div=e,this._ui_div.innerHTML="",this._ui_div.style.width=s.CANVASWIDTH+"px"}return e.prototype._add_btns=function(){var e=this,t=document.createElement("aside"),i=document.createElement("button"),o=document.createElement("button"),n=document.createElement("button"),a=document.createElement("button");i.classList.add("success"),n.classList.add("danger"),i.innerHTML="💾 Save",o.innerHTML="📁 Load",n.innerHTML="↻ Reset",a.innerHTML="↶ Undo",i.onclick=function(t){e._click_save(t).then((function(i){"string"==typeof i&&("function"==typeof e.callback_save?e.callback_save(i):e._click_fallback(t))}))},o.onclick=function(t){e._click_load(t).then((function(i){if("object"==typeof i&&i.name){var n=s.SAVEGAMEPREFIX+"_"+i.name,a=JSON.parse(window.localStorage.getItem(n));i.delete?e._delete_game(i.name,n,o):"function"==typeof e.callback_load?e.callback_load(a):e._click_fallback(t)}}))},n.onclick=function(t){e._click_reset(t).then((function(i){!0===i&&("function"==typeof e.callback_reset?e.callback_reset(t):e._click_fallback(t))}))},a.onclick="function"==typeof this.callback_undo?this.callback_undo:this._click_fallback,t.appendChild(i),t.appendChild(o),t.appendChild(n),t.appendChild(a),this._ui_div.appendChild(t)},e.prototype._add_header=function(){var e=document.createElement("header"),t=document.createElement("h4"),i=document.createElement("h4");t.innerHTML="Score",i.innerHTML="Game Log",e.appendChild(t),e.appendChild(i),this._ui_div.appendChild(e)},e.prototype._add_msgs=function(){var e=document.createElement("ul");e.classList.add("msgs"),e.innerHTML="Loading...",this._ui_div.appendChild(e),this._msgs_ul=e},e.prototype._add_score=function(){var e=this,t=document.createElement("div"),i=document.createElement("span"),s=document.createElement("span"),o=document.createElement("span"),n=document.createElement("span");i.classList.add("score-hdr","white","active"),s.classList.add("white","active"),s.id="score_white",o.classList.add("score-hdr","black"),n.classList.add("black"),n.id="score_black",i.innerHTML="White:",s.innerHTML="0",o.innerHTML="Black:",n.innerHTML="0",t.classList.add("score"),t.appendChild(i),t.appendChild(s),t.appendChild(o),t.appendChild(n),this._ui_div.appendChild(t),this._score_black=n,this._score_hdr_black=o,this._score_white=s,this._score_hdr_white=i,this._score_black.onclick=function(t){e._click_score(0)},this._score_hdr_black.onclick=function(t){e._click_score(0)},this._score_white.onclick=function(t){e._click_score(1)},this._score_hdr_white.onclick=function(t){e._click_score(1)}},e.prototype._click_fallback=function(e){return console.error("Click not implemented for "+e.target.innerHTML),!1},e.prototype._click_load=function(e){for(var t,i=document.createElement("div"),n=[],a=0;a<window.localStorage.length;a++){var r=window.localStorage.key(a);if(0==r.indexOf(s.SAVEGAMEPREFIX)){var c=JSON.parse(window.localStorage.getItem(r));n.push(c)}}return n.sort((function(e,t){return e.saveDate>t.saveDate?-1:e.saveDate<t.saveDate?1:0})),i.innerHTML="Choose a game to load:",n.forEach((function(e,t){var s=document.createElement("div"),o=document.createElement("input"),n=document.createElement("label");s.className="form-group",o.type="radio",o.name="savegame",o.value=e.name,o.id=t+1+"_"+e.name,0==t&&(o.checked=!0),e.saveDate=new Date(e.saveDate),n.setAttribute("for",o.id),n.innerHTML=e.saveDate.toLocaleDateString()+" "+e.saveDate.toLocaleTimeString()+" - "+e.name,s.appendChild(o),s.appendChild(n),i.appendChild(s)})),t={cancel:!0,delete:{text:"Delete",value:"delete",className:"danger"},confirm:{text:"Load Game",value:!0}},new o.Modal("Load Game",i,t).show().then((function(e){var t=document.querySelector('input[name="savegame"]:checked');switch(e){case!0:return{delete:!1,name:t.value};case"delete":return{delete:!0,name:t.value};default:return!1}}))},e.prototype._click_reset=function(e){return new o.Modal("Reset Board","Are you sure you want to reset the board to a new game?",[!0,"Reset Board"],!0).show()},e.prototype._click_save=function(e){var t=document.createElement("div");return t.innerHTML='\n            Enter a name for the save:\n            <div class="form-group">\n                <input type="text" id="saveGameName" placeholder="Save Game 1">\n            </div>\n        ',new o.Modal("Save Game",t,[!0,"Save Game"]).show().then((function(e){return!0===e&&document.getElementById("saveGameName").value}))},e.prototype._click_score=function(e){var t,i=this,n=s.SIDE[e];n!=this._ai_side?(t="Are you sure you want the AI to control "+n+"?",new o.Modal("Engage AI",t,["Cancel","OK"]).show().then((function(t){t&&(e==s.SIDE.white?(i._score_hdr_white.innerHTML="💻 White:",i._score_hdr_black.innerHTML="Black:"):(i._score_hdr_black.innerHTML="💻 Black:",i._score_hdr_white.innerHTML="White:"),i._ai_side=n,"function"==typeof i.callback_engage_ai?i.callback_engage_ai(e):i._click_fallback(null))}))):(t="Are you sure you want to turn the ai off?",new o.Modal("Disengage AI",t,["Cancel","OK"]).show().then((function(t){t&&(i._score_hdr_white.innerHTML="White:",i._score_hdr_black.innerHTML="Black:",i._ai_side=null,"function"==typeof i.callback_engage_ai?i.callback_engage_ai(e,!0):i._click_fallback(null))})))},e.prototype._delete_game=function(e,t,i){new o.Modal("Delete Game","Are you sure you want to delete '"+e+"'?",["Cancel","Delete it"],!0).show().then((function(s){s?(window.localStorage.removeItem(t),new o.Modal("Delete Game","'"+e+"' was successfully deleted.").show()):i.click()}))},e.prototype.draw=function(e,t,i){this._initialized||(this._add_header(),this._add_score(),this._add_msgs(),this._add_btns(),this._initialized=!0),this._score_black.innerHTML=t.toString(),this._score_white.innerHTML=e.toString(),i.length%2?(this._score_hdr_white.classList.remove("active"),this._score_white.classList.remove("active"),this._score_hdr_black.classList.add("active"),this._score_black.classList.add("active")):(this._score_hdr_black.classList.remove("active"),this._score_black.classList.remove("active"),this._score_hdr_white.classList.add("active"),this._score_white.classList.add("active")),this._msgs_ul.innerHTML="";for(var s=0;s<i.length;s++)for(var o=i[i.length-1-s],n=0;n<o.msgs.length;n++){var a=o.msgs[o.msgs.length-1-n],r=document.createElement("li");r.innerHTML=a,this._msgs_ul.appendChild(r)}},e.prototype.getUiDiv=function(){return this._ui_div},e}();t.ChessUi=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Match=void 0;var s=i(0),o=i(8),n=function(){function e(e,t,i){this.checkmate=!1,this.turns=new Array,this.ai_engaged=!1,this.ai=i,this.team1=e,this.team2=t}return e.prototype._updateStatus=function(e){return"function"==typeof this.updateStatusCallback&&this.updateStatusCallback(e)},e.prototype.clearPossible=function(){this.team1.clearPossible(),this.team2.clearPossible()},e.prototype.finishTurn=function(){var e=this.team1.side==this.whosTurn()?this.team1:this.team2,t=e.side==this.team1.side?this.team2:this.team1;if(this.isTeamInCheck(t,!0))return!1;if(this.isTeamInCheck(e,!0)&&!this.checkmate&&(this.checkmate=this.ai.detectCheckMate(e,t),this.checkmate)){var i=e.getPieceByType(s.PIECETYPE.king);return this._updateStatus("CHECKMATE!!! "+t.getSide()+" wins!"),i.captured=!0,t.captures.push(i),!0}if(this.ai_engaged&&this.whosTurn()==this.ai.side){var o=this.ai.side==s.SIDE.white?this.getWhiteTeam():this.getBlackTeam();this.ai.takeTurn(o)}return!0},e.prototype.getBlackTeam=function(){return this.team1.side==s.SIDE.black?this.team1:this.team2},e.prototype.getWhiteTeam=function(){return this.team1.side==s.SIDE.white?this.team1:this.team2},e.prototype.isTeamInCheck=function(e,t){void 0===t&&(t=!1);var i=e.pieces[15].getCoord(),o=e.side==s.SIDE.white?this.getBlackTeam():this.getWhiteTeam();return this.ai.detectCheck(i,o)?(t&&this._updateStatus(e.getSide()+"'s king is in check!"),e.kingInCheck=!0,!0):(1==e.kingInCheck&&(t&&this._updateStatus(e.getSide()+"'s king is no longer in check!"),e.kingInCheck=!1),!1)},e.prototype.startTurn=function(e,t){var i=new o.Turn(e,t.getCoord()),s=e.side==this.team1.side?this.team1:this.team2,n=s.getSide()+" moved "+s.activePiece.getPieceType()+"("+s.activePiece.getCoord().toUpperCase()+") to "+t.getCoord().toUpperCase()+".";if(this.turns.push(i),this._updateStatus(n),t.isOccupied()){var a,r=s.side==this.team1.side?this.team2.getSide():this.team1.getSide(),c=s.getSide()+" captured "+r+" "+t.piece.getPieceType()+"("+t.getCoord().toUpperCase()+") +"+t.piece.value+"pts.";t.piece.captured=!0,a=Object.assign({},t.piece),i.capture=a,s.captures.push(a),this._updateStatus(c)}},e.prototype.whosTurn=function(){return this.turns.length%2?s.SIDE.black:s.SIDE.white},e}();t.Match=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SaveGame=void 0;var s=function(e,t,i,s){this.saveDate=new Date,this.name=e,this.team1=t,this.team2=i,this.turns=s};t.SaveGame=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Team=void 0;var s=i(0),o=i(19),n=i(4),a=i(5),r=i(20),c=i(21),h=i(6),l=function(){function e(e){this.captures=new Array,this.pieces=new Array,this.kingInCheck=!1,this.side=e==s.SIDE.white?s.SIDE.white:s.SIDE.black,this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new a.Pawn(this.side)),this.pieces.push(new h.Rook(this.side)),this.pieces.push(new h.Rook(this.side)),this.pieces.push(new r.Knight(this.side)),this.pieces.push(new r.Knight(this.side)),this.pieces.push(new o.Bishop(this.side)),this.pieces.push(new o.Bishop(this.side)),this.pieces.push(new c.Queen(this.side)),this.pieces.push(new n.King(this.side))}return e.prototype.clearPossible=function(){this.activePiece=null,this.pieces.forEach((function(e){e.active=!1,e.possibleMoves=[]}))},e.prototype.getPieceById=function(e){return this.pieces.find((function(t){return t.getId()==e}))},e.prototype.getPieceByType=function(e){return this.pieces.find((function(t){return t.type==e}))},e.prototype.getSide=function(){return s.CAPITALIZE(s.SIDE[this.side])},e.prototype.getScore=function(){for(var e=0,t=0;t<this.captures.length;t++){e+=this.captures[t].value}return e},e}();t.Team=l},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Bishop=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.bishop)||this;return i.value=325,i.possibleMoves=["c1","f1","c8","f8"],i}return o(t,e),t.prototype.canMove=function(e){return this.active=!0,this.possibleMoves=[],this.possibleMoves=this.possibleMoves.concat(this.getDiagMoves(e,!0,!1),this.getDiagMoves(e,!0,!0),this.getDiagMoves(e,!1,!1),this.getDiagMoves(e,!1,!0)),this.possibleMoves},t}(i(1).Piece);t.Bishop=a},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Knight=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.knight)||this;return i.value=325,i.possibleMoves=["g1","b1","g8","b8"],i}return o(t,e),t.prototype.canMove=function(e){var t=this._coord[0],i=parseInt(this._coord[1]),s=new Array;this.active=!0,this.possibleMoves=[],s.push(""+n.FILE[n.FILE[t]-1]+(i+this._forward+this._forward)),s.push(""+n.FILE[n.FILE[t]+1]+(i+this._forward+this._forward)),s.push(""+n.FILE[n.FILE[t]-2]+(i+this._forward)),s.push(""+n.FILE[n.FILE[t]+2]+(i+this._forward)),s.push(""+n.FILE[n.FILE[t]-1]+(i-this._forward-this._forward)),s.push(""+n.FILE[n.FILE[t]+1]+(i-this._forward-this._forward)),s.push(""+n.FILE[n.FILE[t]-2]+(i-this._forward)),s.push(""+n.FILE[n.FILE[t]+2]+(i-this._forward));for(var o=0;o<s.length;o++){var a=s[o];if(e.cellInBounds(a)){var r=e.getCellByCoord(a);r.isOccupied()&&r.piece.side==this.side||(this.possibleMoves.push(a),r.possibleMove=!0)}}return this.possibleMoves},t}(i(1).Piece);t.Knight=a},function(e,t,i){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Queen=void 0;var n=i(0),a=function(e){function t(t){var i=e.call(this,t,n.PIECETYPE.queen)||this;return i.value=1e3,i.possibleMoves=["d1","d8"],i}return o(t,e),t.prototype.canMove=function(e){return this.active=!0,this.possibleMoves=[],this.possibleMoves=this.possibleMoves.concat(this.getDiagMoves(e,!0,!1),this.getDiagMoves(e,!0,!0),this.getDiagMoves(e,!1,!1),this.getDiagMoves(e,!1,!0)),this.possibleMoves=this.possibleMoves.concat(this.getPerpMoves(e,!0,!0),this.getPerpMoves(e,!0,!1),this.getPerpMoves(e,!1,!0),this.getPerpMoves(e,!1,!1)),this.possibleMoves},t}(i(1).Piece);t.Queen=a}]);